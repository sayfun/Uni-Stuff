<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Curious Case of the Vanishing Engagement</title>
  <style>
    :root {
      --bg: #0b1020;
      --bg-alt: #151a2b;
      --card-bg: #1e2538;
      --accent: #ffb347;
      --accent-soft: rgba(255, 179, 71, 0.2);
      --text-main: #f5f5f7;
      --text-muted: #a4a9c0;
      --danger: #ff5c5c;
      --success: #7ddc8a;
      --radius: 10px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #18213e 0, #050714 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .app {
      max-width: 980px;
      width: 100%;
      background: linear-gradient(145deg, #0d1221, #090b16);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.7);
      padding: 24px 24px 30px;
    }

    header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.07);
      padding-bottom: 16px;
      margin-bottom: 20px;
    }

    .subtitle {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.icon {
      font-size: 22px;
    }

    .chapter-tag {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: var(--text-muted);
    }

    .progress-bar {
      margin-top: 8px;
      height: 4px;
      width: 100%;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #ffd38d);
      transition: width 0.3s ease-out;
    }

    .intro-card {
      background: rgba(10, 15, 32, 0.95);
      border-radius: 12px;
      padding: 14px 16px 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 18px;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .intro-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
      color: var(--accent);
    }

    .section-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin: 18px 0 10px;
    }

    .chapter-screen {
      display: none;
      animation: fadeIn 0.25s ease-out;
    }

    .chapter-screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Start Screen specific styles */
    .start-hero {
        text-align: center;
        padding: 40px 20px;
    }
    .start-icon {
        font-size: 64px;
        margin-bottom: 20px;
        display: block;
        animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }
    .start-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 16px;
    }
    .start-desc {
        font-size: 16px;
        color: var(--text-muted);
        max-width: 600px;
        margin: 0 auto 32px;
        line-height: 1.6;
    }
    .btn-start {
        background: var(--accent);
        color: #211000;
        font-weight: 700;
        font-size: 16px;
        padding: 12px 32px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-start:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px var(--accent-soft);
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .metric-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 14px 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      cursor: pointer;
      position: relative;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        border-color 0.12s ease-out, background 0.12s ease-out;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .metric-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
      border-color: rgba(255, 179, 71, 0.5);
    }

    .metric-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 179, 71, 0.7),
        0 14px 30px rgba(0, 0, 0, 0.7);
      background: linear-gradient(
        145deg,
        rgba(255, 179, 71, 0.15),
        rgba(12, 18, 40, 0.98)
      );
    }

    .metric-id {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
    }

    .metric-text {
      font-size: 14px;
      line-height: 1.4;
      color: var(--text-main);
    }

    .metric-radio {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .metric-radio-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: transparent;
    }

    .metric-card.selected .metric-radio {
      border-color: var(--accent);
    }

    .metric-card.selected .metric-radio-dot {
      background: var(--accent);
    }

    .task-box {
      background: var(--bg-alt);
      border-radius: var(--radius);
      padding: 12px 14px 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 14px;
      font-size: 13px;
      color: var(--text-main);
    }

    .task-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .task-text {
      color: var(--text-muted);
      line-height: 1.5;
      font-size: 13px;
    }
    
    .task-box ul {
        margin: 6px 0 0 18px;
        padding-left: 0;
        font-size: 12px;
        color: var(--text-muted);
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    textarea,
    select,
    input[type="text"] {
      width: 100%;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: #050714;
      color: var(--text-main);
      padding: 7px 9px;
      font-size: 13px;
      outline: none;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    textarea:focus,
    select:focus,
    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 179, 71, 0.4);
    }

    select {
      height: 32px;
    }

    .helper-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    button {
      border-radius: 999px;
      padding: 7px 16px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #211000;
      font-weight: 600;
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(255, 255, 255, 0.16);
    }

    .status {
      font-size: 12px;
      margin-top: 6px;
    }

    .status.error {
      color: var(--danger);
    }

    .status.success {
      color: var(--success);
    }

    .summary-box {
      margin-top: 16px;
      padding: 24px;
      border-radius: 10px;
      background: rgba(9, 32, 20, 0.95);
      border: 1px solid rgba(101, 214, 145, 0.5);
      font-size: 13px;
    }

    .summary-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .chapter-nav {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px dashed rgba(255, 255, 255, 0.16);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .chapter-nav p {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .btn-next {
      background: transparent;
      border-radius: 999px;
      padding: 7px 14px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tada-container {
        text-align: center;
        margin-bottom: 16px;
    }
    .tada-icon {
        font-size: 48px;
        margin-bottom: 8px;
        display: inline-block;
        animation: pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    @keyframes pop {
        0% { transform: scale(0); opacity: 0; }
        70% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }
    .final-instruction {
        text-align: center;
        color: #a8e6cf;
        font-size: 14px;
        margin-bottom: 16px;
        line-height: 1.5;
    }
    .final-instruction strong {
        color: white;
        font-weight: 700;
        border-bottom: 1px solid white;
    }

    .character-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 12px;
      margin-bottom: 10px;
    }

    .character-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 10px 11px 11px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 13px;
    }

    .character-name {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .character-role {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .character-quote {
      font-style: italic;
      color: var(--text-main);
      margin-bottom: 4px;
    }
    
    .character-card .helper-text {
        margin-top: 8px;
        opacity: 0.7;
    }

    .chart-list {
      background: var(--bg-alt);
      border-radius: var(--radius);
      padding: 10px 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 14px;
    }

    .chart-item {
      margin-bottom: 6px;
    }

    .chart-label {
      font-weight: 600;
    }

    .final-output {
      width: 100%;
      min-height: 160px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: #050714;
      color: var(--text-main);
      padding: 8px 9px;
      font-size: 12px;
      resize: vertical;
      white-space: pre-wrap;
    }

    @media (max-width: 640px) {
      .app {
        padding: 16px 14px 22px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="subtitle">Analytics Adventure</div>
      <div class="top-row">
        <h1>
          <span class="icon">üß≠</span>
          <span>The Curious Case of the Vanishing Engagement</span>
        </h1>
        <div class="chapter-tag" id="chapterTag">Briefing</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </header>

    <!-- START SCREEN (Chapter 0) -->
    <section id="chapter-0" class="chapter-screen active">
        <div class="start-hero">
            <span class="start-icon">üïµÔ∏è‚Äç‚ôÄÔ∏è</span>
            <div class="start-title">The Case of the Vanishing Engagement</div>
            <p class="start-desc">
                Engagement metrics at MUIC have dropped to zero. The logs are corrupted. The stakeholders are panicking.<br><br>
                Your mission: Analyze the data fragments, navigate conflicting stakeholder opinions, and design a concrete action plan to save the semester.
            </p>
            <button class="btn-start" id="btnStartGame">Begin Investigation ‚û°Ô∏è</button>
        </div>
    </section>

    <!-- CHAPTER 1 -->
    <section id="chapter-1" class="chapter-screen">
      <div class="intro-card">
        <div class="intro-title">Chapter 1 ¬∑ The Island of Misleading Metrics üèùÔ∏è</div>
        <p>
          Your analytics ship crashes on the shores of Analytics Island. The sand is
          warm, the Wi-Fi is questionable, and the only things that washed up with you
          are six data fragments.
        </p>
        <p style="margin-top:6px;">
           Some are useful. Some are misleading. Some actively want to trick you.
           To leave the beach, you must choose <strong>one</strong> metric worth
           carrying forward as your anchor insight.
        </p>
      </div>

      <div class="section-title">Data fragments on the beach</div>
      <div class="metrics-grid" id="metricsGrid"></div>

      <div class="task-box">
        <div class="task-title">Step 1 ‚Äì Your choice (Anchor Metric)</div>
        <div class="task-text">
           Review all six fragments and choose <strong>ONE</strong> anchor metric.
        </div>
        <ul>
           <li>Which fragment tells you something meaningful about <strong>quality</strong> or <strong>behavior</strong>?</li>
           <li>Which one is more than just a ‚Äúnumbers look big‚Äù moment?</li>
           <li>Which one would you actually show in a serious MUIC meeting?</li>
        </ul>
      </div>

      <div class="form-group">
        <label for="ch1Justification">Why did you choose this as your anchor metric?</label>
        <textarea id="ch1Justification"
          placeholder="Explain in 3‚Äì5 sentences why this is your main metric and what story it suggests..."></textarea>
      </div>

      <div class="task-box">
         <div class="task-title">Step 2 ‚Äì Solo Quest: Defense & Counter-Arguments</div>
         <div class="task-text">
            Solo quest extension: After choosing your anchor metric, write:
         </div>
         <ul>
            <li>One short <strong>defense</strong> of why your choice is the strongest signal.</li>
            <li>Two short <strong>counter-arguments</strong> explaining why two other fragments would be misleading or weaker choices.</li>
         </ul>
         <div class="task-text" style="margin-top:8px; font-style:italic; font-size:12px;">
            Imagine you are arguing against confused stakeholders who love vanity metrics, not against other student teams.
         </div>
      </div>

      <div class="form-group">
        <label>Defense ‚Äì why your anchor wins</label>
        <textarea id="ch1Defense" placeholder="Defend your anchor metric as the best lens..."></textarea>
      </div>
      
      <div class="form-group">
        <label>Counter-arguments against other metrics</label>
        <textarea id="ch1Rebuttal" placeholder="Explain why two alternative anchor metrics would be less useful or misleading..."></textarea>
      </div>

      <div class="task-box">
        <div class="task-title">Instructor Checkpoint</div>
        <div class="task-text">
           Before moving to Chapter 2, make sure you are prepared to explain your choice in 30‚Äì60 seconds during a later class discussion.
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="ch1Submit">‚úÖ Submit Chapter 1</button>
      </div>
      <div class="status" id="ch1Status"></div>
    </section>

    <!-- CHAPTER 2 -->
    <section id="chapter-2" class="chapter-screen">
      <div class="intro-card">
        <div class="intro-title">Chapter 2 ¬∑ The Council of Conflicting Stakeholders üèõÔ∏è</div>
        <p>
          You climb the hill and meet three powerful voices arguing about what your anchor metric ‚Äúreally‚Äù means.
          Your job is to decide who helps you tell a useful story, not just who is the loudest.
        </p>
        <p style="margin-top:6px;">Start by reminding yourself what you picked in Chapter 1.</p>
      </div>

      <div class="section-title">Stakeholders on the hill</div>
      <div class="character-grid">
        <div class="character-card">
          <div class="character-role">Dean of Panic</div>
          <div class="character-name">‚ÄúWe are losing reputation.‚Äù</div>
          <div class="character-quote">
            ‚ÄúEngagement is down? This is catastrophic. Fix it immediately. I don‚Äôt want
            excuses; I want a strong, simple answer.‚Äù
          </div>
          <div class="helper-text">
            Cares about: optics, simple answers, short-term risk.
          </div>
        </div>
        <div class="character-card">
          <div class="character-role">Marketing Pirate</div>
          <div class="character-name">‚ÄúThe numbers look fine.‚Äù</div>
          <div class="character-quote">
            ‚ÄúReach is up, followers are up, everything looks great. Students are just
            busy with exams. We don‚Äôt need to change anything.‚Äù
          </div>
          <div class="helper-text">
            Cares about: defending current work, vanity metrics.
          </div>
        </div>
        <div class="character-card">
          <div class="character-role">Student Ghost</div>
          <div class="character-name">‚ÄúIt‚Äôs not for us.‚Äù</div>
          <div class="character-quote">
            ‚ÄúI see your posts but I don‚Äôt really care. They feel generic and not really
            about student life.‚Äù
          </div>
          <div class="helper-text">
            Cares about: relevance, tone, authenticity.
          </div>
        </div>
      </div>

      <div class="task-box">
        <div class="task-title">Step 1 ‚Äì Classify the voices</div>
        <div class="task-text">
          On your own, classify each role:
        </div>
      </div>

      <div class="form-group">
        <label>Most analytically useful perspective</label>
        <select id="ch2Useful">
          <option value="">Select one‚Ä¶</option>
          <option value="dean">Dean of Panic</option>
          <option value="marketing">Marketing Pirate</option>
          <option value="student">Student Ghost</option>
        </select>
      </div>

      <div class="form-group">
        <label>Most emotion-driven perspective</label>
        <select id="ch2Emotional">
          <option value="">Select one‚Ä¶</option>
          <option value="dean">Dean of Panic</option>
          <option value="marketing">Marketing Pirate</option>
          <option value="student">Student Ghost</option>
        </select>
      </div>

      <div class="form-group">
        <label>Most misleading perspective</label>
        <select id="ch2Misleading">
          <option value="">Select one‚Ä¶</option>
          <option value="dean">Dean of Panic</option>
          <option value="marketing">Marketing Pirate</option>
          <option value="student">Student Ghost</option>
        </select>
      </div>

      <div class="task-box">
        <div class="task-title">Step 2 ‚Äì Build your Sparkline</div>
        <div class="task-text">
          You must turn your Chapter 1 anchor metric into a story using a simple Duarte-style arc:
        </div>
      </div>

      <div class="form-group">
        <label>‚ÄúWhat is‚Äù ‚Äì current state</label>
        <textarea id="ch2WhatIs"
          placeholder="Describe the current reality as your data suggests it."></textarea>
      </div>

      <div class="form-group">
        <label>Conflict / tension</label>
        <textarea id="ch2Conflict"
          placeholder="What‚Äôs the main problem, mismatch, or risk?"></textarea>
      </div>

      <div class="form-group">
        <label>Insight ‚Äì turning point</label>
        <textarea id="ch2Insight"
          placeholder="What key insight changes how we understand the situation?"></textarea>
      </div>

      <div class="form-group">
        <label>‚ÄúWhat could be‚Äù ‚Äì improved future</label>
        <textarea id="ch2CouldBe"
          placeholder="What realistic, improved future becomes possible?"></textarea>
      </div>
      
      <div class="task-box">
          <div class="task-title">Step 3 ‚Äì Solo quest extension: Perspective rewrites</div>
          <div class="task-text">Rewrite your <strong>insight</strong> from three different perspectives:</div>
          <ul>
              <li>Reflect on how your own understanding changes when you switch voices.</li>
          </ul>
      </div>
      
      <div class="form-group">
          <label>Insight from the Dean‚Äôs perspective</label>
          <textarea id="ch2InsightDean" placeholder="Short, strong, risk-focused."></textarea>
      </div>
      <div class="form-group">
          <label>Insight from the Marketing Pirate‚Äôs perspective</label>
          <textarea id="ch2InsightPirate" placeholder="Defensive spin on the strategy."></textarea>
      </div>
      <div class="form-group">
          <label>Insight from the Student Ghost‚Äôs perspective</label>
          <textarea id="ch2InsightStudent" placeholder="Bored, annoyed, or unimpressed."></textarea>
      </div>

      <div class="task-box">
        <div class="task-title">Instructor Checkpoint</div>
        <div class="task-text">
           Be ready to explain your stakeholder choice, story arc, and one rewritten perspective in a later class discussion.
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="ch2Submit">‚úÖ Submit Chapter 2</button>
      </div>
      <div class="status" id="ch2Status"></div>
    </section>

    <!-- CHAPTER 3 -->
    <section id="chapter-3" class="chapter-screen">
      <div class="intro-card">
        <div class="intro-title">Chapter 3 ¬∑ The Temple of Missing Context üóø</div>
        <p>
          Deeper inside the island, you find three impressive-looking charts carved into stone. 
          They would look great in a slide deck. They are also terrible.
        </p>
        <p style="margin-top:6px;">
          Your job is not to ‚Äúmake them pretty‚Äù. Your job is to stop them from lying.
        </p>
      </div>

      <div class="section-title">Ancient charts on the wall</div>
      <div class="chart-list">
        <div class="chart-item">
          <span class="chart-label">Chart A:</span> Bar chart titled
          <em>‚ÄúEngagement by Month‚Äù</em>, but neither the Y-axis nor the timeframe
          labels are visible.
        </div>
        <div class="chart-item">
          <span class="chart-label">Chart B:</span> Line chart titled
          <em>‚ÄúPosts per Week vs Applications‚Äù</em>. The lines move in the same
          direction, but there is no indication of causality.
        </div>
        <div class="chart-item">
          <span class="chart-label">Chart C:</span> Pie chart titled
          <em>‚ÄúContent Types‚Äù</em> with slices that sum to 132%.
        </div>
      </div>

      <div class="task-box">
        <div class="task-title">Step 1 ‚Äì Choose your stone</div>
        <div class="task-text">
          On your own, choose <strong>one</strong> chart that is most dangerous or misleading.
        </div>
      </div>

      <div class="form-group">
        <label>Which chart did you pick?</label>
        <select id="ch3ChartChoice">
          <option value="">Select one‚Ä¶</option>
          <option value="A">Chart A ‚Äì Engagement by Month</option>
          <option value="B">Chart B ‚Äì Posts vs Applications</option>
          <option value="C">Chart C ‚Äì Content Types</option>
        </select>
      </div>

      <div class="form-group">
        <label>Step 2 ‚Äì What context is missing or unclear?</label>
        <textarea id="ch3Missing"
          placeholder="Describe exactly what information is missing: labels, timeframe, causality, definitions..."></textarea>
      </div>

      <div class="form-group">
        <label>Step 3 ‚Äì Rewrite: what should this chart honestly say?</label>
        <textarea id="ch3Rewrite"
          placeholder="Write a more honest interpretation, as if annotating for a stakeholder."></textarea>
      </div>
      
      <div class="task-box">
        <div class="task-title">Step 4 ‚Äì Solo quest extension: Honest vs. Evil Charts</div>
        <div class="task-text">
            1) Create an honest, corrected version of your chosen chart (fix labels, scales, titles, and context).<br>
            2) Then, create a deliberately manipulated 'evil' version (e.g., distorted axis, missing labels, exaggerated visuals).<br>
            3) Write 2‚Äì4 sentences below explaining exactly how your manipulated version could mislead a stakeholder.
        </div>
      </div>
      
      <div class="form-group">
          <label>Describe your honest and evil versions</label>
          <textarea id="ch3Mockup" placeholder="Describe the changes in your honest version, and then explain the tricks used in your 'evil' version."></textarea>
      </div>

      <div class="task-box">
        <div class="task-title">Instructor Checkpoint</div>
        <div class="task-text">
           Be ready to show and explain both your honest and manipulated chart versions in a future class discussion.
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="ch3Submit">‚úÖ Submit Chapter 3</button>
      </div>
      <div class="status" id="ch3Status"></div>
    </section>

    <!-- CHAPTER 4 -->
    <section id="chapter-4" class="chapter-screen">
      <div class="intro-card">
        <div class="intro-title">Chapter 4 ¬∑ The Final Gate ‚Äì Action Engine üîÆ</div>
        <p>
          You reach the final gate. The guardian asks only one question:
          <br><br>
          <strong>‚ÄúSo what do you want someone at MUIC to actually do next week?‚Äù</strong>
        </p>
        <p>
          Use Fogg‚Äôs Behavior Model: <strong>Behavior = Motivation √ó Ability √ó Prompt</strong>.
        </p>
      </div>

      <div class="task-box">
        <div class="task-title">Step 1 ‚Äì Quick recap of your story</div>
        <div class="task-text" id="ch4AnchorPreview">
          <!-- Filled by JS -->
        </div>
      </div>
      
      <div class="form-group">
          <label>Story recap (anchor + insight + risk/opportunity)</label>
          <textarea id="ch4StoryRecap" placeholder="Write 2‚Äì3 sentences summarizing your findings so far..."></textarea>
      </div>

      <div class="task-box">
        <div class="task-title">Step 2 ‚Äì Design your behavior (B=MAP)</div>
        <div class="task-text">
          Choose <strong>one concrete behavior</strong> you want a stakeholder to perform.
        </div>
      </div>

      <div class="form-group">
        <label>Motivation ‚Äì why would the stakeholder want to do this?</label>
        <textarea id="ch4Motivation"
          placeholder="What pain are you reducing, or what positive outcome are you creating?"></textarea>
      </div>

      <div class="form-group">
        <label>Ability ‚Äì how do you make the action easy?</label>
        <textarea id="ch4Ability"
          placeholder="Reduce friction: time, complexity, approvals, budget, steps."></textarea>
      </div>

      <div class="form-group">
        <label>Prompt ‚Äì what triggers the action at the right moment?</label>
        <textarea id="ch4Prompt"
          placeholder="Specify a moment + channel (e.g., weekly meeting, email report)."></textarea>
      </div>

      <div class="form-group">
        <label>Step 3 ‚Äì Final action statement</label>
        <textarea id="ch4Action"
          placeholder="Combine everything into one clear sentence."></textarea>
      </div>
      
      <div class="task-box">
          <div class="task-title">Step 4 ‚Äì Solo quest extension ‚Äì Self-review</div>
          <div class="task-text">Before finalizing your action, review your own recommendation using these questions:</div>
          <ul>
              <li>Would someone understand the behavior in 10 seconds?</li>
              <li>Is this action realistic within the next 30 days?</li>
              <li>Does the prompt happen at a specific, sensible moment?</li>
          </ul>
          <div class="task-text">Based on your answers, rewrite your action one more time below.</div>
      </div>
      
      <div class="form-group">
          <label>Your self-review notes</label>
          <textarea id="ch4Feedback" placeholder="Notes on clarity, realism, and prompt timing based on the questions above."></textarea>
      </div>
      
      <div class="form-group">
          <label>Step 5 ‚Äì Revised final action (after self-review)</label>
          <textarea id="ch4RevisedAction" placeholder="Rewrite your action statement to make it clearer and more realistic."></textarea>
      </div>

      <div class="task-box">
        <div class="task-title">Instructor Checkpoint & Future Sharing</div>
        <div class="task-text">
           You may be asked to share your final action in a future make-up class or discussion group.
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="ch4Submit">‚úÖ Finish Adventure & Generate Summary</button>
      </div>
      <div class="status" id="ch4Status"></div>

      <div class="summary-box" id="ch4Summary" style="display:none;">
        <div class="tada-container">
            <div class="tada-icon">üéâ</div>
            <div class="summary-title" style="font-size: 16px; color: #7ddc8a;">Mission Accomplished!</div>
        </div>
        <p class="final-instruction">
            Great job, Investigator. Your analysis is complete.<br>
            Please copy the report below and paste it into the <strong>Google Classroom</strong> assignment.
        </p>
        <textarea class="final-output" id="finalOutput" readonly></textarea>
        <div class="chapter-nav" style="justify-content: center;">
          <button class="btn-next" id="copyOutput" style="background: #7ddc8a; color: #092014; border: none; font-weight: 700;">
            Copy Report to Clipboard üìã
          </button>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Global state
    let currentChapter = 0;
    const totalChapters = 4;

    const state = {
      // CH1
      anchorMetricId: null,
      anchorMetricText: "",
      anchorJustification: "",
      anchorDefense: "",
      anchorRebuttal: "",
      // CH2
      ch2Useful: "",
      ch2Emotional: "",
      ch2Misleading: "",
      storyWhatIs: "",
      storyConflict: "",
      storyInsight: "",
      storyCouldBe: "",
      insightDean: "",
      insightPirate: "",
      insightStudent: "",
      // CH3
      ch3ChartChoice: "",
      ch3Missing: "",
      ch3Rewrite: "",
      ch3Mockup: "",
      // CH4
      storyRecap: "",
      actionMotivation: "",
      actionAbility: "",
      actionPrompt: "",
      actionStatement: "",
      feedbackReceived: "",
      revisedAction: ""
    };

    const chapterTag = document.getElementById("chapterTag");
    const progressFill = document.getElementById("progressFill");

    function updateChapterUI() {
      document.querySelectorAll(".chapter-screen").forEach((ch) => {
        ch.classList.remove("active");
      });
      const active = document.getElementById(`chapter-${currentChapter}`);
      if (active) active.classList.add("active");

      if (currentChapter === 0) {
          chapterTag.textContent = "Briefing";
          progressFill.style.width = "0%";
      } else {
          chapterTag.textContent = `Chapter ${currentChapter} of ${totalChapters}`;
          const pct = (currentChapter - 1) / (totalChapters - 1 || 1) * 100;
          progressFill.style.width = `${pct}%`;
      }
    }

    function goToChapter(n) {
      currentChapter = n;
      updateChapterUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Start Screen Logic
    document.getElementById("btnStartGame").addEventListener("click", () => {
        goToChapter(1);
    });

    // CHAPTER 1 ‚Äì metrics setup (HARD MODE: NO LABELS/HINTS)
    const metrics = [
      { id: "Fragment A", text: "‚ÄúTotal Reach: Up +51% last month.‚Äù" },
      { id: "Fragment B", text: "‚ÄúEngagement Rate (organic posts only): Down from 4.3% ‚Üí 2.8%.‚Äù" },
      { id: "Fragment C", text: "Line chart with dramatic spikes, but Y-axis runs from 98% to 100%." },
      { id: "Fragment D", text: "‚ÄúComment sentiment: Neutral ‚Üí Slightly Negative over 6 weeks.‚Äù" },
      { id: "Fragment E", text: "Randomly highlighted KPI: ‚ÄúProfile Visits: +6000%‚Äù." },
      { id: "Fragment F", text: "‚ÄúAverage watch time on video content: Down 18%.‚Äù" },
    ];

    const metricsGrid = document.getElementById("metricsGrid");
    const ch1Justification = document.getElementById("ch1Justification");
    const ch1Defense = document.getElementById("ch1Defense");
    const ch1Rebuttal = document.getElementById("ch1Rebuttal");
    const ch1Submit = document.getElementById("ch1Submit");
    const ch1Status = document.getElementById("ch1Status");
    const toCh2Btn = document.getElementById("toCh2");
    let selectedMetricId = null;

    function renderMetrics() {
      metricsGrid.innerHTML = "";
      metrics.forEach((metric) => {
        const card = document.createElement("div");
        card.className = "metric-card";
        card.dataset.id = metric.id;
        card.innerHTML = `
          <div class="metric-id">${metric.id}</div>
          <div class="metric-text">${metric.text}</div>
          <div class="metric-radio"><div class="metric-radio-dot"></div></div>
        `;
        card.addEventListener("click", () => selectMetric(metric.id));
        metricsGrid.appendChild(card);
      });
    }

    function selectMetric(id) {
      selectedMetricId = id;
      document.querySelectorAll(".metric-card").forEach((card) => {
        card.classList.toggle("selected", card.dataset.id === id);
      });
      ch1Status.textContent = "";
      ch1Status.className = "status";
    }

    function submitCh1() {
      const just = ch1Justification.value.trim();
      const def = ch1Defense.value.trim();
      const reb = ch1Rebuttal.value.trim();

      if (!selectedMetricId) {
        ch1Status.textContent = "Select one metric before submitting.";
        ch1Status.className = "status error";
        return;
      }
      if (just.length < 10 || def.length < 10 || reb.length < 10) {
        ch1Status.textContent = "Please complete the Justification, Defense, and Counter-arguments fields.";
        ch1Status.className = "status error";
        return;
      }
      
      const metric = metrics.find((m) => m.id === selectedMetricId);
      state.anchorMetricId = metric.id;
      state.anchorMetricText = metric.text;
      state.anchorJustification = just;
      state.anchorDefense = def;
      state.anchorRebuttal = reb;

      ch1Status.textContent = "Chapter 1 submitted. Unlocking Chapter 2...";
      ch1Status.className = "status success";
      setTimeout(() => goToChapter(2), 1000);
    }

    ch1Submit.addEventListener("click", submitCh1);

    // CHAPTER 2 logic
    const ch2Useful = document.getElementById("ch2Useful");
    const ch2Emotional = document.getElementById("ch2Emotional");
    const ch2Misleading = document.getElementById("ch2Misleading");
    const ch2WhatIs = document.getElementById("ch2WhatIs");
    const ch2Conflict = document.getElementById("ch2Conflict");
    const ch2Insight = document.getElementById("ch2Insight");
    const ch2CouldBe = document.getElementById("ch2CouldBe");
    const ch2InsightDean = document.getElementById("ch2InsightDean");
    const ch2InsightPirate = document.getElementById("ch2InsightPirate");
    const ch2InsightStudent = document.getElementById("ch2InsightStudent");
    const ch2Submit = document.getElementById("ch2Submit");
    const ch2Status = document.getElementById("ch2Status");

    function submitCh2() {
      const useful = ch2Useful.value;
      const emotional = ch2Emotional.value;
      const misleading = ch2Misleading.value;
      const whatIs = ch2WhatIs.value.trim();
      const conflict = ch2Conflict.value.trim();
      const insight = ch2Insight.value.trim();
      const couldBe = ch2CouldBe.value.trim();
      const iDean = ch2InsightDean.value.trim();
      const iPirate = ch2InsightPirate.value.trim();
      const iStudent = ch2InsightStudent.value.trim();

      if (!useful || !emotional || !misleading) {
        ch2Status.textContent = "Classify all three perspectives.";
        ch2Status.className = "status error";
        return;
      }

      if (whatIs.length < 10 || conflict.length < 10 || insight.length < 10 || couldBe.length < 10) {
        ch2Status.textContent = "Please complete the Story Arc sections.";
        ch2Status.className = "status error";
        return;
      }
      
      if (iDean.length < 10 || iPirate.length < 10 || iStudent.length < 10) {
          ch2Status.textContent = "Please rewrite the insight from all 3 perspectives.";
          ch2Status.className = "status error";
          return;
      }

      state.ch2Useful = useful;
      state.ch2Emotional = emotional;
      state.ch2Misleading = misleading;
      state.storyWhatIs = whatIs;
      state.storyConflict = conflict;
      state.storyInsight = insight;
      state.storyCouldBe = couldBe;
      state.insightDean = iDean;
      state.insightPirate = iPirate;
      state.insightStudent = iStudent;

      ch2Status.textContent = "Chapter 2 submitted. Unlocking Chapter 3...";
      ch2Status.className = "status success";
      setTimeout(() => goToChapter(3), 1000);
    }

    ch2Submit.addEventListener("click", submitCh2);

    // CHAPTER 3 logic
    const ch3ChartChoice = document.getElementById("ch3ChartChoice");
    const ch3Missing = document.getElementById("ch3Missing");
    const ch3Rewrite = document.getElementById("ch3Rewrite");
    const ch3Mockup = document.getElementById("ch3Mockup");
    const ch3Submit = document.getElementById("ch3Submit");
    const ch3Status = document.getElementById("ch3Status");

    function submitCh3() {
      const choice = ch3ChartChoice.value;
      const missing = ch3Missing.value.trim();
      const rewrite = ch3Rewrite.value.trim();
      const mockup = ch3Mockup.value.trim();

      if (!choice) {
        ch3Status.textContent = "Select which chart you‚Äôre correcting.";
        ch3Status.className = "status error";
        return;
      }
      if (missing.length < 10 || rewrite.length < 10 || mockup.length < 5) {
        ch3Status.textContent = "Please complete all fields, including the Honest vs Evil chart descriptions.";
        ch3Status.className = "status error";
        return;
      }

      state.ch3ChartChoice = choice;
      state.ch3Missing = missing;
      state.ch3Rewrite = rewrite;
      state.ch3Mockup = mockup;

      ch3Status.textContent = "Chapter 3 submitted. Unlocking Final Chapter...";
      ch3Status.className = "status success";
      setTimeout(() => {
          // Fill Chapter 4 anchor preview
          const anchorText = state.anchorMetricId && state.anchorMetricText
              ? `${state.anchorMetricId}: ${state.anchorMetricText}`
              : "(No anchor metric saved)";
          const ch4AnchorPreview = document.getElementById("ch4AnchorPreview");
          ch4AnchorPreview.innerHTML = `
            <strong>Anchor metric:</strong> ${anchorText}<br>
            <strong>Core Insight:</strong> ${state.storyInsight || "..."}
          `;
          goToChapter(4);
      }, 1000);
    }

    ch3Submit.addEventListener("click", submitCh3);

    // CHAPTER 4 logic
    const ch4StoryRecap = document.getElementById("ch4StoryRecap");
    const ch4Motivation = document.getElementById("ch4Motivation");
    const ch4Ability = document.getElementById("ch4Ability");
    const ch4Prompt = document.getElementById("ch4Prompt");
    const ch4Action = document.getElementById("ch4Action");
    const ch4Feedback = document.getElementById("ch4Feedback");
    const ch4RevisedAction = document.getElementById("ch4RevisedAction");
    const ch4Submit = document.getElementById("ch4Submit");
    const ch4Status = document.getElementById("ch4Status");
    const ch4Summary = document.getElementById("ch4Summary");
    const finalOutput = document.getElementById("finalOutput");
    const copyOutputBtn = document.getElementById("copyOutput");

    function submitCh4() {
      const recap = ch4StoryRecap.value.trim();
      const mot = ch4Motivation.value.trim();
      const abil = ch4Ability.value.trim();
      const pr = ch4Prompt.value.trim();
      const act = ch4Action.value.trim();
      const fb = ch4Feedback.value.trim();
      const rev = ch4RevisedAction.value.trim();

      if (recap.length < 10 || mot.length < 10 || abil.length < 10 || pr.length < 10 || act.length < 10 || fb.length < 5 || rev.length < 10) {
        ch4Status.textContent = "Please complete all steps, including the Self-review notes.";
        ch4Status.className = "status error";
        return;
      }

      state.storyRecap = recap;
      state.actionMotivation = mot;
      state.actionAbility = abil;
      state.actionPrompt = pr;
      state.actionStatement = act;
      state.feedbackReceived = fb;
      state.revisedAction = rev;

      // Build final output text
      const lines = [];
      lines.push("=== THE CURIOUS CASE OF THE VANISHING ENGAGEMENT: SOLO REPORT ===");
      lines.push("");
      
      lines.push("--- 1. ANCHOR METRIC ---");
      lines.push(`Metric: ${state.anchorMetricId ? `${state.anchorMetricId}: ${state.anchorMetricText}` : "(none)"}`);
      lines.push(`Justification: ${state.anchorJustification}`);
      lines.push(`Defense: ${state.anchorDefense}`);
      lines.push(`Counter-arguments: ${state.anchorRebuttal}`);
      lines.push("");

      lines.push("--- 2. STORY ARC & STAKEHOLDERS ---");
      lines.push(`What is: ${state.storyWhatIs}`);
      lines.push(`Conflict: ${state.storyConflict}`);
      lines.push(`Insight: ${state.storyInsight}`);
      lines.push(`What could be: ${state.storyCouldBe}`);
      lines.push(`Dean's Voice: ${state.insightDean}`);
      lines.push(`Pirate's Voice: ${state.insightPirate}`);
      lines.push(`Student's Voice: ${state.insightStudent}`);
      lines.push("");

      lines.push("--- 3. DATA CONTEXT (CHART) ---");
      lines.push(`Chart Choice: ${state.ch3ChartChoice}`);
      lines.push(`Missing Context: ${state.ch3Missing}`);
      lines.push(`Honest Rewrite: ${state.ch3Rewrite}`);
      lines.push(`Honest vs Evil Description: ${state.ch3Mockup}`);
      lines.push("");

      lines.push("--- 4. ACTION ENGINE (FOGG B=MAP) ---");
      lines.push(`Motivation: ${state.actionMotivation}`);
      lines.push(`Ability: ${state.actionAbility}`);
      lines.push(`Prompt: ${state.actionPrompt}`);
      lines.push(`Initial Action: ${state.actionStatement}`);
      lines.push(`Self-Review Notes: ${state.feedbackReceived}`);
      lines.push(`FINAL REVISED ACTION: ${state.revisedAction}`);

      finalOutput.value = lines.join("\n");
      ch4Summary.style.display = "block";
      
      setTimeout(() => {
        ch4Summary.scrollIntoView({ behavior: 'smooth' });
      }, 100);

      ch4Status.textContent = "Adventure complete!";
      ch4Status.className = "status success";
    }

    ch4Submit.addEventListener("click", submitCh4);

    copyOutputBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(finalOutput.value);
        const originalText = copyOutputBtn.innerHTML;
        copyOutputBtn.innerHTML = "Copied! ‚úÖ";
        copyOutputBtn.style.background = "#fff";
        setTimeout(() => {
             copyOutputBtn.innerHTML = originalText;
             copyOutputBtn.style.background = "#7ddc8a";
        }, 2000);
      } catch (e) {
        ch4Status.textContent = "Could not copy automatically. Please select and copy manually.";
        ch4Status.className = "status error";
      }
    });

    // Init
    renderMetrics();
    updateChapterUI();
  </script>
</body>
</html>
